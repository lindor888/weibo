T.postBtnBind=function(d,b){var c=T.g(d);var a=function(){setTimeout(function(){T.dom.removeClass(c,"disabled")},1000)};T.on(c,"click",function(f){if(T.dom.hasClass(c,"disabled")){T.event.stop(f)}else{T.dom.addClass(c,"disabled");b(f,a)}})};function stopDefault(b){if(b&&b.preventDefault){b.preventDefault()}else{window.event.returnValue=false}return false}var G=T.g;var prev=T.dom.prev;var next=T.dom.next;var INFO={};INFO.noTargetUrl="请您输入目标URL";INFO.notTrans="请您输入正确的路径URL";INFO.wrongTransIncome="您的输入超出了系统允许的范围，请重新输入。";INFO.wrongTransCent="请您输入1-100之间的整数";INFO.deleteStep="您确定删除这个步骤吗？";INFO.deleteTargetUrl="您确定删除这个URL吗？";INFO.deletePath="您确定删除这个路径吗？";INFO.noTransName="请您输入目标名称";INFO.noTargetUrl="请您输入目标URL";var target_adds=T.q("target-add-page");for(var i=0;i<target_adds.length;i++){target_adds[i].onclick=add_target_page}if(T.q("Steps").length>0){if(T.q("add_step").length>0){T.q("add_step")[0].getElementsByTagName("a")[0].onclick=addStep}var img=T.q("hand",T.q("Steps")[0]);for(i=0,len=img.length;i<len;i++){img[i].onclick=deleteStepDiv}var urlDel=T.dom.query(".added-step .hand");if(urlDel.length>0){for(var i=0;i<urlDel.length;i++){urlDel[i].onclick=del_add_path_page}}}var path_adds=T.q("path_add_page");for(var i=0;i<path_adds.length;i++){path_adds[i].onclick=add_path_page}var del_paths=T.q("path-title");if(del_paths.length>0){for(var i=0;i<del_paths.length;i++){T.q("hand",del_paths[i])[0].onclick=del_path}}T.event.on(T.dom.one("#add_path a"),"click",add_path);var add_order_number=T.G("add_order_number");var trans_pages=T.q("TransPage");var LAST_TARGET_PAGE_INDEX=T.G("LAST_TARGET_PAGE_INDEX");LAST_TARGET_PAGE_INDEX.value=trans_pages.length-1;for(var i=0;i<trans_pages.length;i++){trans_pages[i].onfocus=setTransPagesIndex}add_order_number.onclick=addOrderNumber;function addOrderNumber(f){var f=f?f:window.event;var g=f.target?f.target:f.srcElement;stopDefault(f);var b=T.G("radio_order_number");b.checked=true;var c=T.G("LAST_TARGET_PAGE_INDEX").value;var a=T.q("TransPage")[c];if(!(/\[\[\[\*\]\]\]/.test(a.value))){a.value+="[[[*]]]"}}T.postBtnBind("SubmitTrans",submit_trans);var path_names=T.dom.query(".path-title>input");if(path_names.length>0){for(var i=0;i<path_names.length;i++){bindPathFocusBlur(path_names[i])}}var step_names=T.dom.query("input.step-name");if(step_names.length>0){for(var i=0;i<step_names.length;i++){bindStepFocusBlur(step_names[i])}}resetStepNum&&resetStepNum();function resetLastTransPagesIndex(){var b=T.q("TransPage");var a=T.G("LAST_TARGET_PAGE_INDEX");a.value=b.length-1}function setTransPagesIndex(f){var f=f?f:window.event;var a=f.target?f.target:f.srcElement;var d=T.q("TransPage");var c=T.G("LAST_TARGET_PAGE_INDEX");for(var b=0;b<d.length;b++){if(d[b]==a){c.value=b}}}function resetStepNum(){var d=T.q("Steps");if(d.length>0){for(var c=0;c<d.length;c++){var b=T.q("step-label",d[c]);for(var a=0;a<b.length;a++){b[a].innerHTML="步骤"+(a+1)}}}}function add_target_page(c){var c=c?c:window.event;var f=c.target?c.target:c.srcElement;stopDefault(c);var a=f.parentNode;var b=document.createElement("div");T.dom.addClass(b,"first-second-step");T.dom.addClass(b,"clearfix");b.innerHTML='<div class="clear"></div><input class="l" type="text" style="width:120px;visibility:hidden;" disabled="disabled" /> <p class="l">或&nbsp;</p><input type="text" name="trans_page" class="TransPage l new-trans-page" /> <a class="hand l" href="javascript:void(0);">&nbsp;</a> ';T.q("hand",b)[0].onclick=del_add_target_page;b.getElementsByTagName("input")[1].onfocus=setTransPagesIndex;T.dom.insertAfter(b,a);if(T.q("first-second-step").length==5){f.style.display="none"}resetLastTransPagesIndex()}function add_path_page(c){var c=c?c:window.event;var f=c.target?c.target:c.srcElement;stopDefault(c);var a=f.parentNode;var b=document.createElement("div");T.dom.addClass(b,"added-step");T.dom.addClass(b,"clearfix");b.innerHTML='<input class="l" type="text" disabled="disabled" style="width:159px; visibility:hidden" /> <p class="l">或&nbsp;</p><input class="step-url l" type="text" name="step_url[]" maxlength="200" value="步骤URL" defaultText="步骤URL" /> <a class="hand l" href="javascript:void(0);">&nbsp;</a> ';T.q("hand",b)[0].onclick=del_add_path_page;T.inlineTip(T.q("step-url",b)[0]);a.appendChild(b);if(T.q("added-step",a).length==4){f.style.visibility="hidden"}}function add_path(f){stopDefault(f);var a=document.createElement("div");T.dom.addClass(a,"page-trans-path");var g='<div class="path-title"> <span style="display:none;">路径1</span> <input type="text" class="default-path-name l" maxlength="20" value="路径名称" defaultText="路径名称" />  <a class="hand l" onclick="del_path(event);" href="javascript:void(0);">&nbsp;</a><label><input type="checkbox" class="cross-path-input">只有经过路径的目标记为转化</label></div> <div> <div class="Steps"> <div class="Steps_title"> &nbsp; </div> ';var b='<div class="step clearfix"> <p class="l step-label">步骤1</p><input defaultText="步骤名称" value="步骤名称" class="step-name default-step-name l" type="text" name="step_name[]" maxlength="20" /> <input defaultText="步骤URL" value="步骤URL" class="step-url" type="text" name="step_url[]" maxlength="200" /> <a onclick="add_path_page(event);" class="path_add_page" href="#">添加页面</a> <a class="hand" onclick="deleteStepDiv(event);" href="javascript:void(0);">&nbsp;</a> </div> ';var d='<div class="add_step"><a href="#" onclick="addStep(event);">添加步骤</a></div>';a.innerHTML=g+b+b+"</div> "+d;bindPathFocusBlur(a.getElementsByTagName("input")[0]);var k=T.q("step-name",a);for(var c=0;c<k.length;c++){bindStepFocusBlur(k[c])}T.inlineTip(T.q("default-path-name",a)[0]);var h=T.q("step-name",a);T.each(h,function(e){T.inlineTip(e)});var j=T.q("step-url",a);T.each(j,function(e){T.inlineTip(e)});T.dom.insertBefore(a,T.G("add_path"));if(T.q("path-title").length==5){G("add_path").style.display="none"}resetPathNum&&resetPathNum();resetStepNum&&resetStepNum()}function bindStepFocusBlur(a){}function bindPathFocusBlur(a){return}function del_add_target_page(c){var c=c?c:window.event;stopDefault(c);var f=c.target?c.target:c.srcElement;var a=f.parentNode;var b=a.parentNode;if(T.string.trim(prev(f).value)==""){b.removeChild(a)}else{if(confirm(INFO.deleteTargetUrl)){b.removeChild(a)}else{return}}var g=T.q("target-add-page")[0];if(T.q("first-second-step").length<5){g.style.display=""}resetLastTransPagesIndex();return}function del_add_path_page(c){stopDefault(c);var c=c?c:window.event;var f=c.target?c.target:c.srcElement;var b=f.parentNode;var a=b.parentNode;a.removeChild(b);var g=a.getElementsByTagName("a")[0];if(T.q("added-step",a).length<4){g.style.visibility="visible"}}function del_path(g){var g=g?g:window.event;var j=g.target?g.target:g.srcElement;stopDefault(g);var a=j.parentNode.parentNode;var c=a.parentNode;var b=T.q("step-url",a);var h="";for(var f=0;f<b.length;f++){h+=T.string.trim(b[f].value)}if(h==""){c.removeChild(a)}else{if(confirm(INFO.deletePath)){T.ajax.jsonPost(T.config.systemConfig.ajaxUri,{method:"home/trans/page/deletePath",siteId:T.config.siteInfo.id,targetId:T.dom.getAttr(G("TransName"),"target-id"),pathId:T.dom.getAttr(a,"path-id")},function(e,d){c.removeChild(a)},function(d){alert(d)})}else{return}}if(T.q("path-title").length<5){G("add_path").style.display=""}resetPathNum&&resetPathNum();resetStepNum&&resetStepNum()}function resetPathNum(){var b=T.dom.query(".path-title>span");if(b.length>0){for(var a=0;a<b.length;a++){b[a].innerHTML="路径"+(a+1)}}}function submit_trans(B,C){if(!vali_submit_trans()){C();return}var y=T.config.siteInfo.id;var o=G("TransName").value;var p=[];var d=T.q("TransPage");for(var x=0;x<d.length;x++){p[x]=T.string.trim(getInputValue(d[x]))}var a=T.dom.query(".m-way:checked")[0].value;var g=G("TransIncome").value;var b=G("TransCent").value;var t=[];var f=T.dom.query(".page-trans-path");for(var x=0;x<f.length;x++){var s={};s.id=G("Status").value=="edit"?(T.dom.getAttr(f[x],"path-id")):0;s.name=T.string.trim(T.q("path-title",f[x])[0].getElementsByTagName("input")[0].value);s.isNecessary=T.dom.query(".cross-path-input",f[x])[0].checked;s.stepList=[];var h=T.q("step",f[x]);for(var w=0;w<h.length;w++){var z={};z.id=G("Status").value=="edit"?(T.dom.getAttr(h[w],"step-id")):0;z.name=T.string.trim(T.q("step-name",h[w])[0].value);z.urlList=[];var c=T.q("step-url",h[w]);for(var v=0;v<c.length;v++){z.urlList.push(T.string.trim(getInputValue(c[v])))}s.stepList.push(z)}t.push(s)}var A=TransType.getSelectedItems()[0];var q="";var D=T.config.pageInfo.pageTransTypes;if(A==D[D.length-1].id&&T.g("TransTypeOther").value!=""){q=T.string.trim(T.g("TransTypeOther").value)}var n={targetInfo:{siteId:y,id:G("Status").value=="edit"?(T.dom.getAttr(G("TransName"),"target-id")):0,name:o,urlList:p,mode:a,pageTransType:A,pageTransTypeName:q,exptRevenue:g,exptTransRate:b,pathList:t}};var m=T.dom.query(".page-trans-path-detail input");var r="";for(var u=0;u<m.length;u++){r+=T.string.trim(m[u].value)}if(r==""){n.targetInfo.pathList=[]}T.ajax.jsonPost(T.config.systemConfig.ajaxUri,{method:"home/trans/page/add",data:T.json.stringify(n),siteId:T.config.siteInfo.id},function(j,e){C()},function(e){C();alert(e)})}function vali_submit_trans(){removeErrorMsgs();var g=true;var d=G("TransName");if(T.string.trim(d.value)==""){T.dom.addClass(d,"err");T.dom.insertAfter(h(INFO.noTransName),d);d.focus();g=false}var a=T.q("TransPage")[0];if(T.string.trim(a.value)==""){T.dom.addClass(a,"err");T.dom.insertAfter(h(INFO.noTargetUrl),next(a));a.focus();g=false}else{var f=/\S+/;var c=T.q("TransPage");for(var e=0;e<c.length;e++){if(T.string.trim(c[e].value).match(f)==null){T.dom.addClass(c[e],"err");if(c[e]==a){T.dom.insertAfter(h(INFO.notTrans),next(c[e]))}else{T.dom.insertAfter(h(INFO.notTrans,137),next(c[e]))}c[e].focus();g=false}}}var j=G("TransIncome");j.value=T.string.trim(j.value);if(/^0+$/.test(j.value)){j.value="0"}else{j.value=j.value.replace(/^0*/,"")}if(!isIncome(j.value)){T.dom.addClass(j,"err");T.dom.insertAfter(h(INFO.wrongTransIncome,105),next(j));j.focus();g=false}var b=G("TransCent");b.value=T.string.trim(b.value);if(/^0+$/.test(b.value)){b.value="0"}else{b.value=b.value.replace(/^0*/,"")}if(!isCent(b.value)){T.dom.addClass(b,"err");b.parentNode.appendChild(h(INFO.wrongTransCent,105));b.focus();g=false}function h(m,k){var l=document.createElement("div");l.innerHTML=m;var k=k||0;T.dom.addClass(l,"err-msg");T.setStyles(l,{margin:"0",padding:"0"});T.setStyle(l,"padding-left",k+"px");T.setStyle(l,"clear","both");return l}return g}function removeErrorMsgs(){var a=T.dom.query("input.err");for(var b=0;b<a.length;b++){T.dom.removeClass(a[b],"err")}var c=T.dom.query("div.err-msg");for(var b=0;b<c.length;b++){T.dom.remove(c[b])}}function addStep(f){var f=f?f:window.event;stopDefault(f);var d=f.target?f.target:f.srcElement;var c=d.parentNode.parentNode.parentNode;var a=T.q("Steps",c)[0];var b=document.createElement("div");T.dom.addClass(b,"step");T.dom.addClass(b,"clearfix");b.innerHTML='<p class="l step-label">步骤2</p><input class="step-name l default-step-name" type="text" name="step_name[]" maxlength="20" value="步骤名称" defaultText="步骤名称" /> <input class="step-url" type="text" name="step_url[]" maxlength="200" value="步骤URL" defaultText="步骤URL" /> <a class="path_add_page" href="javascript:void(0);">添加页面</a> <a class="hand" href="javascript:void(0);">&nbsp;</a> ';a.appendChild(b);T.q("hand",b)[0].onclick=deleteStepDiv;T.inlineTip(T.q("step-name",b)[0]);T.inlineTip(T.q("step-url",b)[0]);b.getElementsByTagName("a")[0].onclick=add_path_page;var g=T.dom.children(prev(d.parentNode)).length+1;bindStepFocusBlur(b.getElementsByTagName("input")[0]);if(g==12){d.parentNode.style.display="none"}resetStepNum&&resetStepNum()}function deleteStepDiv(j){var j=j?j:window.event;var b=j.target?j.target:j.srcElement;var c=b.parentNode;var m=c.parentNode;var k=b;var a=T.dom.children(k.parentNode.parentNode).length+1;var g=k.parentNode.parentNode.parentNode;var o=T.q("add_step",g)[0];var f=T.q("step-url",c);var l="";for(var d=0;d<f.length;d++){l+=T.string.trim(getInputValue(f[d]))}if(l==""){m.removeChild(c)}else{if(confirm(INFO.deleteStep)){m.removeChild(c)}else{return}}if(a==12){o.style.display=""}if(a==3){var h=g.parentNode;h.parentNode.removeChild(h)}resetStepNum&&resetStepNum()}function isIncome(c){var b=/^((\d{0,8}(\.\d+)?)|(\d{1,8}(\.\d*)?))$/;if(T.string.trim(c).length==0){return true}else{var a=parseFloat(c);return b.test(c)&&(a<=21474836)&&(a>=0.005)}}function isCent(b){var a=/^([1-9]|[1-9]\d|100)?$/;return a.test(b)}function getInputValue(a){if(!T.g(a)){return""}var a=T.g(a);if(a.value==T.dom.getAttr(a,"defaultText")){return""}else{return a.value}}var delAry=T.dom.query(".first-second-step .hand");for(var i=0;i<delAry.length;i++){delAry[i].onclick=del_add_target_page}setInterval(function(){var a=T.q("path-title");if(a.length==5){T.g("add_path").style.display="none"}else{if(a.length<5){T.g("add_path").style.display=""}}},600);T.getTipElement=function(a){var b=T.dom.create("div",{style:"position: absolute;"});b.className="tip-container";b.innerHTML='<div style="position: relative;top:8px; left:-10px;" class="tip-div tip-theme title-theme"><div class="tip-arrow"></div><div class="tip-wrap">'+a+"</div></div>";return b};T.ui.Tip.bindEvent();var tipContainer=T.getTipElement("按不同方式记录访客经过目标页面的次数，默认按访次记录，30分钟内同一访客经过页面多次计为1次转化。");new T.ui.Tip({target:T.q("help")[0],tip:tipContainer});var tipContainer2=T.getTipElement("预期每完成一次目标转化能给您带来的收益。");new T.ui.Tip({target:T.q("help")[1],tip:tipContainer2});var tipContainer3=T.getTipElement("预期对您网站的所有访问中，有多大比例可能完成目标转化。");new T.ui.Tip({target:T.q("help")[2],tip:tipContainer3});var tipContainer4=T.getTipElement("您的转化目标页面是何种类型的页面。");new T.ui.Tip({target:T.q("help")[3],tip:tipContainer4});var TransType;var pageInfo=T.config.pageInfo;T.dom.ready(function(){var b=pageInfo.pageTransTypes[pageInfo.pageTransTypes.length-1].id;TransType=new T.ui.CheckGroup({containerId:"TransType",label:"",items:[pageInfo.pageTransTypes],autoRender:true,limit:1,selectedItems:[T.config.targetInfo.pageTransType],onchange:function(f){if(f[0]==b){T.g("TransTypeOther").focus()}}});T.event.on(T.g("TransTypeOther"),"focus",function(){TransType&&TransType.click(b)});var c=T.dom.one;e(c(".page-trans-record-type-title"),c(".page-trans-record-type-detail"));e(c(".page-trans-path-title"),c(".page-trans-path-detail"));e(c(".page-trans-income-title"),c(".page-trans-income-detail"));e(c(".page-trans-type-title"),c(".page-trans-type-detail"));T.event.fire(c(".page-trans-type-title"),"click");function e(f,g){T.event.on(f,"click",function(h,j){T.dom.toggle(g);T.dom.toggleClass(j,"open")})}T.event.on(document,"click",function(g){var h=T.event.getTarget(g);var j=T.dom.hasClass(h,"page-trans-record-type-title")?h:T.dom.getAncestorByClass(h,"page-trans-record-type-title");var f=T.dom.hasClass(h,"page-trans-record-type-detail")?h:T.dom.getAncestorByClass(h,"page-trans-record-type-detail");if(!j&&!f){T.dom.hide(c(".page-trans-record-type-detail"))}});if(T.G("Status").value=="edit"){var d=T.config.pathId;if(d){T.event.fire(c(".page-trans-path-title"),"click");var a=T.dom.query("div[path-id="+d+"] input")[0];if(a){a.focus()}}}});